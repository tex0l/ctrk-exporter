# CTRK Exporter

A TypeScript toolkit for parsing Yamaha Y-Trac motorcycle telemetry files.

## What is CTRK?

CTRK files are proprietary binary telemetry files generated by the Yamaha Y-Trac data logging system used on motorcycles. They contain GPS coordinates, CAN bus data (engine telemetry, IMU, brakes, etc.), and lap timing information recorded at 10 Hz.

## Packages

| Package | Description |
|---------|-------------|
| `@tex0l/ctrk-parser` | Platform-agnostic parser (Node.js + browser) |
| `@tex0l/ctrk-cli` | Command-line interface for batch parsing |
| `@tex0l/ctrk-astro` | Astro integration with Vue.js components, composables, and utilities |

## Quick Start

### Library

```bash
npm install @tex0l/ctrk-parser
```

```typescript
import { readFileSync } from 'fs';
import { CTRKParser, Calibration } from '@tex0l/ctrk-parser';

const data = new Uint8Array(readFileSync('session.CTRK'));
const parser = new CTRKParser(data);
const records = parser.parse();

for (const r of records) {
  console.log(`Lap ${r.lap} | ${Calibration.rpm(r.rpm)} RPM | ${Calibration.wheelSpeedKmh(r.front_speed).toFixed(1)} km/h`);
}
```

### CLI

```bash
npm install -g @tex0l/ctrk-cli
ctrk-parser parse session.CTRK
ctrk-parser parse *.CTRK --output results/
```

### Web App

```bash
npm run dev -w packages/ctrk-astro/examples/web
```

Open http://localhost:4321 and drag a CTRK file to analyze it interactively.

## Project Structure

```
packages/
  ctrk-parser/              # @tex0l/ctrk-parser
  ctrk-cli/                 # @tex0l/ctrk-cli
  ctrk-astro/               # @tex0l/ctrk-astro (includes components, lib, workers, styles)
    examples/web/            # Full web app example (@tex0l/ctrk-web)
exploration/                 # Original Python parser and R&D
docs/                        # Format spec, parser docs, web guide
```

## Documentation

- **[CTRK Format Specification](docs/CTRK_FORMAT_SPECIFICATION.md)** — Complete binary file format documentation
- **[TypeScript Parser](docs/TYPESCRIPT_PARSER.md)** — Parser architecture and validation
- **[Web User Guide](docs/WEB_USER_GUIDE.md)** — Interactive web app documentation

## Development

```bash
npm install
npm run build
npm test
```

## Releasing

```bash
npm version prerelease --workspaces --include-workspace-root
git push --follow-tags
```

This bumps all package versions, commits, tags, and pushes. The GitHub Actions publish workflow triggers on `v*` tags and publishes all packages to npm via trusted publishing (OIDC).

## Backstory

I'm not a motorcyclist. A friend told me he had tried to extract data from his CTRK files without success. I said it would be easy with Claude. It became a matter of principle.

The truth is: it took 23% of my weekly Claude Max quota, but I got it done in 48 hours.

## License

MIT License

## Acknowledgments

- File format reverse-engineered from the official Y-Trac application
- Calibration formulas verified using radare2 disassembly of the native library
- Heavily assisted by [Claude Code](https://claude.ai/code)
