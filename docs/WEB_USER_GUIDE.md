# CTRK-Exporter Web Edition - User Guide

**Version:** 1.0
**Date:** 2026-02-07
**Target Audience:** Motorcyclists using Yamaha Y-Trac data logger

---

## Table of Contents

1. [Overview](#overview)
2. [Getting Started](#getting-started)
3. [Uploading Files](#uploading-files)
4. [GPS Track Map](#gps-track-map)
5. [Telemetry Graphs](#telemetry-graphs)
6. [Lap Timing](#lap-timing)
7. [Telemetry Channels Reference](#telemetry-channels-reference)
8. [Supported Browsers](#supported-browsers)
9. [Limitations](#limitations)
10. [Privacy and Security](#privacy-and-security)
11. [FAQ](#faq)
12. [Developer Guide](#developer-guide)

---

## Overview

CTRK-Exporter Web Edition is a browser-based telemetry analyzer for Yamaha Y-Trac motorcycle data logger files. It provides interactive visualization of your track sessions, including GPS track maps, multi-channel telemetry graphs, and lap timing analysis.

### What It Does

- Parses .CTRK files from your Yamaha Y-Trac data logger
- Displays your GPS track on an interactive map with color-coded laps
- Visualizes 21 telemetry channels (RPM, speed, throttle, brakes, lean angle, etc.) in synchronized graphs
- Computes lap times and deltas to your best lap
- Exports lap timing data to CSV for further analysis

### Key Features

- **100% Client-Side**: All processing happens in your browser. No data is uploaded to any server.
- **No Installation Required**: Works directly in your web browser. No software to download or install.
- **Interactive Visualizations**: Pan, zoom, and explore your data with responsive charts and maps.
- **Fast Processing**: Typical 30-minute sessions parse in under 100 milliseconds using Web Workers.

---

## Getting Started

### Accessing the Web App

1. Open your web browser (Chrome 90+, Firefox 88+, Safari 15+, or Edge 90+)
2. Navigate to the CTRK-Exporter Web Edition URL (provided by your deployment or local server)
3. You'll see the landing page with an upload area

### System Requirements

- Modern web browser with JavaScript enabled
- Minimum 2 GB RAM (4 GB recommended for large sessions)
- Internet connection (only for initial page load; processing works offline)

---

## Uploading Files

### Supported Files

CTRK-Exporter Web Edition accepts files with the `.CTRK` extension generated by the Yamaha Y-Trac CCU (Communication Control Unit) data logger.

### File Size Limits

- **Minimum**: 100 bytes
- **Maximum**: 50 MB

Typical track session files range from 500 KB to 5 MB depending on session duration and GPS quality.

### Upload Methods

#### Method 1: Drag and Drop

1. On the landing page or analysis page, locate the file upload area
2. Open your file browser and locate your .CTRK file
3. Drag the file into the upload area (marked by a dashed border)
4. Release the mouse button to drop the file

The parser will validate the file and begin processing immediately.

#### Method 2: Click to Browse

1. Click anywhere in the upload area or click the "Choose File" button
2. Your system file browser will open
3. Navigate to your .CTRK file
4. Select the file and click "Open"

The parser will validate the file and begin processing immediately.

### Upload Validation

The app performs several validation checks:

1. **File Extension**: Must be `.CTRK` (case-insensitive)
2. **File Size**: Must be between 100 bytes and 50 MB
3. **Magic Bytes**: First 4 bytes must be "HEAD" (0x48 0x45 0x41 0x44)

If validation fails, you'll see an error message explaining the issue:
- "Invalid file type. Please select a .CTRK file."
- "File is too small (X bytes). Minimum size is 100 bytes."
- "File is too large (X MB). Maximum size is 50 MB."
- "Invalid CTRK file format. Expected magic bytes 'HEAD', got '...'"

### Processing Feedback

Once a valid file is uploaded:

1. A progress indicator appears
2. The parser runs in a background Web Worker (your browser remains responsive)
3. Upon completion, the analysis page displays with your telemetry data
4. If parsing fails, an error message explains the issue

---

## GPS Track Map

The GPS track map visualizes your motorcycle's path around the circuit using interactive mapping technology powered by Leaflet.js.

### Map Features

#### Interactive Controls

- **Pan**: Click and drag to move the map
- **Zoom**: Use mouse wheel, pinch gesture (on touch devices), or the +/- buttons
- **Reset View**: Double-click to reset to the full track view

#### Lap Colors

Each lap is displayed as a colored line on the map. The app uses a distinct color palette that cycles through 15 colors:

1. Red
2. Blue
3. Green
4. Orange
5. Purple
6. Cyan
7. Pink
8. Deep Orange
9. Teal
10. Lime
11. Amber
12. Deep Purple
13. Light Green
14. Brown
15. Blue Gray

If your session has more than 15 laps, the colors repeat (lap 16 uses the same color as lap 1, etc.).

#### Selecting a Lap

Click on any lap line on the map to select that lap. When selected:
- The lap line becomes highlighted (thicker stroke)
- The telemetry graphs update to show only that lap's data
- The lap timing table highlights the corresponding row

To deselect and view all laps, click on the map background.

#### GPS Fix Indicator

If GPS data is unavailable or has no satellite fix, the map displays a message:
- "No GPS data available"
- "Waiting for GPS fix..."

Once GPS acquires a fix, the map automatically updates with your track.

### Map Layers

The default map uses OpenStreetMap tiles, which show:
- Road networks
- Track outlines (if mapped)
- Surrounding terrain
- Landmarks

---

## Telemetry Graphs

The telemetry graphs display up to 21 channels of sensor data from your motorcycle, synchronized in time at 10 Hz (one data point every 100 milliseconds).

### Graph Layout

Telemetry channels are organized into 8 groups for clarity:

1. **Engine** (enabled by default)
2. **Speed** (enabled by default)
3. **Chassis** (enabled by default)
4. **Brakes** (enabled by default)
5. **Acceleration** (disabled by default)
6. **Temperature** (disabled by default)
7. **Fuel** (disabled by default)
8. **Electronics** (disabled by default)

### Channel Groups

#### 1. Engine

| Channel | Unit | Color | Y-Axis |
|---------|------|-------|--------|
| RPM | RPM | Red | rpm |
| Throttle (TPS) | % | Orange | throttle |
| Throttle (APS) | % | Yellow | throttle |
| Gear | -- | Blue | gear |

**TPS** = Throttle Position Sensor (actual throttle valve opening)
**APS** = Accelerator Position Sensor (rider's throttle grip position)

Both throttle channels share the same Y-axis for easy comparison.

#### 2. Speed

| Channel | Unit | Color | Y-Axis |
|---------|------|-------|--------|
| Front Speed | km/h | Blue | speed |
| Rear Speed | km/h | Cyan | speed |
| GPS Speed | km/h | Green | speed |

All speed channels share the same Y-axis. Comparing front/rear wheel speeds can reveal wheel slip or wheelie/stoppie behavior.

#### 3. Chassis

| Channel | Unit | Color | Y-Axis |
|---------|------|-------|--------|
| Lean Angle | ° | Purple | lean |
| Pitch Rate | °/s | Pink | pitch |

**Lean Angle**: Signed lean angle in degrees. Positive and negative values indicate lean in opposite directions (left vs. right).
**Pitch Rate**: Angular velocity of the motorcycle's pitch axis. Positive = nose up, negative = nose down.

#### 4. Brakes

| Channel | Unit | Color | Y-Axis |
|---------|------|-------|--------|
| Front Brake | bar | Red | brake |
| Rear Brake | bar | Orange | brake |

Hydraulic brake pressure in bar. Both channels share the same Y-axis.

#### 5. Acceleration (Disabled by Default)

| Channel | Unit | Color | Y-Axis |
|---------|------|-------|--------|
| Acc X | G | Red | acc |
| Acc Y | G | Blue | acc |

**Acc X**: Longitudinal acceleration (forward/backward)
**Acc Y**: Lateral acceleration (left/right)

Both channels share the same Y-axis.

#### 6. Temperature (Disabled by Default)

| Channel | Unit | Color | Y-Axis |
|---------|------|-------|--------|
| Water Temp | °C | Blue | temp |
| Intake Temp | °C | Orange | temp |

**Water Temp**: Engine coolant temperature
**Intake Temp**: Intake air temperature

Both channels share the same Y-axis.

#### 7. Fuel (Disabled by Default)

| Channel | Unit | Color | Y-Axis |
|---------|------|-------|--------|
| Fuel | cc | Green | fuel |

Cumulative fuel consumption in cubic centimeters. This value resets to 0 at the start of each lap.

#### 8. Electronics (Disabled by Default)

| Channel | Unit | Color | Y-Axis |
|---------|------|-------|--------|
| TCS | -- | Blue | bool |
| SCS | -- | Cyan | bool |
| LIF | -- | Green | bool |
| Launch | -- | Orange | bool |
| F_ABS | -- | Red | bool |
| R_ABS | -- | Pink | bool |

**TCS**: Traction Control System active (1 = active, 0 = inactive)
**SCS**: Slide Control System active
**LIF**: Lift Control active
**Launch**: Launch Control active
**F_ABS**: Front ABS active
**R_ABS**: Rear ABS active

All boolean channels are rendered as 0 or 1 and share the same Y-axis.

### Enabling/Disabling Channels

To improve performance and reduce visual clutter, you can enable or disable entire channel groups:

1. Locate the channel group toggle buttons above the graphs
2. Click a group name to toggle it on or off
3. Enabled groups are highlighted; disabled groups are grayed out
4. The graphs update immediately

### Graph Interactions

#### Zoom

- **Mouse Wheel**: Scroll to zoom in/out on the time axis
- **Pinch**: On touch devices, pinch to zoom in/out
- **Zoom Box**: Click and drag to select a time range for detailed inspection

#### Pan

- **Click and Drag**: Move the time axis left/right (after zooming in)

#### Reset

- **Double-Click**: Reset zoom and pan to view the entire lap/session

#### Tooltip

- **Hover**: Move your cursor over the graph to see exact values at each timestamp

### Synchronized Graphs

All graph groups are synchronized in time. When you zoom or pan on one graph, all enabled graphs update to show the same time range. This makes it easy to correlate events across multiple channels (e.g., seeing RPM drop when TCS activates).

---

## Lap Timing

The lap timing table displays computed lap times, deltas to the best lap, and session statistics.

### Timing Table Columns

| Column | Description |
|--------|-------------|
| Lap | Lap number (1-based) |
| Time | Lap time in MM:SS.sss format |
| Delta | Time difference from the best lap (in seconds, +/- format) |

### Best Lap Highlighting

The best lap row is highlighted with a distinct background color (typically green or gold). The delta column shows "+0.000" for the best lap.

### Delta Format

Deltas are displayed with a sign prefix:
- **+1.234**: This lap was 1.234 seconds slower than the best lap
- **-0.567**: This lap was 0.567 seconds faster than the best lap (should not occur if best lap is correctly identified)
- **+0.000**: This is the best lap

### Lap Detection

Laps are detected via GPS-based finish line crossing. The finish line is defined by two GPS coordinates stored in the CTRK file header (typically set when you configure the Y-Trac app).

If no finish line is configured in the file:
- All data is assigned to lap 1
- No lap deltas are computed

### Lap 0 Behavior

Some files contain a "lap 0" representing data before the first finish line crossing. The timing table skips lap 0 when computing the best lap and deltas, since lap 0 is typically an incomplete lap (e.g., out-lap from the pits).

### Session Summary

Below the timing table, you'll see session statistics:
- **Total Laps**: Number of complete laps (excluding lap 0)
- **Best Lap**: Lap number of the fastest lap
- **Best Time**: Time of the fastest lap
- **Average Time**: Mean lap time across all laps

### CSV Export

To export the lap timing table as a CSV file:

1. Locate the "Export CSV" button below the timing table
2. Click the button
3. Your browser will download a file named `lap_times_YYYYMMDD-HHMMSS.csv`

The CSV file contains all columns from the timing table and can be opened in Excel, Google Sheets, or any CSV-compatible application.

---

## Telemetry Channels Reference

CTRK-Exporter Web Edition parses and displays 21 telemetry channels from your Y-Trac data logger.

### Analog Channels (15)

| Channel | Source | Formula | Unit | Range |
|---------|--------|---------|------|-------|
| RPM | CAN 0x0209 | int(raw / 2.56) | RPM | 0 - 18,000+ |
| Throttle Grip (APS) | CAN 0x0215 | ((raw / 8.192) × 100) / 84.96 | % | 0 - 100+ |
| Throttle (TPS) | CAN 0x0215 | ((raw / 8.192) × 100) / 84.96 | % | 0 - 100+ |
| Front Speed | CAN 0x0264 | (raw / 64.0) × 3.6 | km/h | 0 - 300+ |
| Rear Speed | CAN 0x0264 | (raw / 64.0) × 3.6 | km/h | 0 - 300+ |
| GPS Speed | NMEA GPRMC | raw × 1.852 | km/h | 0 - 300+ |
| Gear | CAN 0x0209 | direct (0-6) | -- | 0 (N), 1-6 |
| Lean Angle | CAN 0x0258 | (raw / 100.0) - 90.0 | ° | -60 to +60 |
| Pitch Rate | CAN 0x0258 | (raw / 100.0) - 300.0 | °/s | -150 to +150 |
| Front Brake | CAN 0x0260 | raw / 32.0 | bar | 0 - 20+ |
| Rear Brake | CAN 0x0260 | raw / 32.0 | bar | 0 - 20+ |
| Water Temp | CAN 0x023E | (raw / 1.6) - 30.0 | °C | 0 - 130 |
| Intake Temp | CAN 0x023E | (raw / 1.6) - 30.0 | °C | 0 - 130 |
| Fuel | CAN 0x023E | raw / 100.0 | cc | 0 - 1000+ |
| Acc X | CAN 0x0250 | (raw / 1000.0) - 7.0 | G | -2 to +2 |
| Acc Y | CAN 0x0250 | (raw / 1000.0) - 7.0 | G | -2 to +2 |

### Boolean Channels (6)

| Channel | Source | Bit/Byte | Description |
|---------|--------|----------|-------------|
| F_ABS | CAN 0x0268 | Byte 4, bit 1 | Front ABS active |
| R_ABS | CAN 0x0268 | Byte 4, bit 0 | Rear ABS active |
| TCS | CAN 0x0215 | Byte 7, bit 5 | Traction Control System active |
| SCS | CAN 0x0215 | Byte 7, bit 4 | Slide Control System active |
| LIF | CAN 0x0215 | Byte 7, bit 3 | Lift Control active |
| Launch | CAN 0x0215 | Byte 6, bits 6-5 | Launch Control active |

### Channel Notes

- **RPM**: Truncated to integer after calibration (e.g., 10000, not 10000.39)
- **Throttle (TPS vs. APS)**: TPS measures the actual throttle valve position; APS measures the rider's grip position. They may differ due to throttle-by-wire intervention.
- **Lean Angle**: Signed lean angle preserving direction. Positive and negative values indicate opposite lean directions (left vs. right). A deadband of approximately ±5 degrees is applied by the hardware, and values are truncated to the nearest degree (not rounded).
- **Pitch Rate**: Positive values indicate nose up rotation; negative values indicate nose down.
- **Fuel**: Cumulative consumption that resets to 0 at the start of each lap.
- **GPS Speed**: Converted from knots (NMEA standard) to km/h.

### Sampling Rate

All channels are emitted at **10 Hz** (one data point every 100 milliseconds). The Y-Trac CCU records CAN bus messages at variable rates but the parser outputs synchronized 10 Hz telemetry for consistent visualization and analysis.

---

## Supported Browsers

CTRK-Exporter Web Edition requires a modern web browser with the following features:

- Web Workers
- File API
- ES2020+ JavaScript features
- Canvas API (for charts)
- Geolocation API (optional, for map centering)

### Tested Browsers

| Browser | Minimum Version | Status |
|---------|----------------|--------|
| Chrome | 90+ | Fully Supported |
| Firefox | 88+ | Fully Supported |
| Safari | 15+ | Fully Supported |
| Edge | 90+ | Fully Supported |

### Browser Notes

- **Safari 14 and earlier**: Not supported due to missing Web Worker features
- **Internet Explorer**: Not supported (EOL)
- **Mobile browsers**: Supported on iOS Safari 15+ and Chrome for Android 90+

### Browser Compatibility Checks

When you open the web app, it automatically checks for required browser features. If your browser is incompatible, you'll see a message explaining which features are missing and suggesting alternative browsers.

---

## Limitations

### Current Limitations

1. **Single File Only**: The web app currently supports analyzing one CTRK file at a time. You cannot compare multiple sessions or overlay data from different files.

2. **No Server-Side Processing**: All processing happens in your browser. This means:
   - No permanent storage of your data (reload the page and you must re-upload)
   - No sharing of analysis results via URL
   - No cloud backup or sync

3. **File Size Limit**: Maximum file size is 50 MB. Sessions longer than ~4 hours may exceed this limit.

4. **Memory Usage**: Large files (>10 MB) may require significant browser memory (2-4 GB). Very old devices or browsers with many open tabs may struggle.

5. **No Offline Mode**: While processing works offline after the initial page load, you must have an internet connection to access the web app initially.

6. **No Sector Timing**: The app does not support sector splits or intermediate timing points. Only lap times are computed.

7. **No Data Editing**: You cannot edit or correct telemetry data (e.g., fixing GPS glitches, adjusting lap markers).

### Planned Features

The following features are planned for future releases:

- Multi-file comparison (overlay laps from different sessions)
- Session persistence (save analysis in browser local storage)
- Shareable analysis URLs
- Export to additional formats (GPX, JSON, etc.)
- Sector timing and reference lap
- Data filtering and smoothing options

See the project backlog for the complete roadmap.

---

## Privacy and Security

### Data Privacy

**Your data never leaves your device.**

All CTRK file processing happens entirely in your web browser using JavaScript and Web Workers. No data is uploaded to any server, cloud service, or third party.

When you upload a .CTRK file:
1. The file is read from your local filesystem
2. The parser processes it in a sandboxed Web Worker
3. The results are displayed in your browser
4. When you close the browser tab, all data is discarded

### What Data Is Stored?

**None.** The web app does not use cookies, local storage, or any form of persistent storage. Every time you reload the page, you start fresh.

### Analytics and Tracking

The web app does not include:
- Google Analytics or similar tracking
- Third-party advertising scripts
- Social media widgets
- Usage telemetry

The only network requests are:
- Initial page load (HTML, CSS, JavaScript)
- Map tiles from OpenStreetMap (if you view the GPS map)

### Security Features

The web app implements security best practices:

- **Content Security Policy (CSP)**: Restricts resource loading to prevent code injection
- **X-Frame-Options**: Prevents the app from being embedded in iframes (clickjacking protection)
- **X-Content-Type-Options**: Prevents MIME type sniffing
- **Referrer-Policy**: Controls referrer information leakage
- **Permissions-Policy**: Disables unused browser features (camera, microphone, etc.)

### Web Worker Sandboxing

The CTRK parser runs in a Web Worker, which is a sandboxed background thread separate from the main browser UI. This provides:
- Isolation from the main page (cannot access DOM or user input)
- Performance (parser cannot block the UI thread)
- Security (even if the parser had a bug, it cannot affect the rest of the browser)

### HTTPS

If deploying the web app to production, always use HTTPS to:
- Encrypt data in transit
- Prevent man-in-the-middle attacks
- Enable modern browser features (some features require secure context)

---

## FAQ

### File Upload and Parsing

**Q: Why does my file fail to upload with "Invalid CTRK file format"?**

A: The file does not start with the required "HEAD" magic bytes. This can happen if:
- The file is corrupted
- The file was modified by a text editor or compression tool
- The file is from an incompatible Y-Trac CCU version

Try re-downloading the file from your CCU or Y-Trac app.

**Q: Why do I see "No GPS data available"?**

A: The CTRK file contains no valid GPS (GPRMC) sentences. This can happen if:
- GPS had no satellite fix during the session (e.g., indoor testing)
- The CCU did not record GPS data
- The file is from a very short session (< 10 seconds)

The telemetry graphs will still work, but the GPS map and lap detection will not.

**Q: The parser seems stuck at "Processing...". What should I do?**

A: Large files (>10 MB) can take 10-30 seconds to parse. If processing takes longer than 1 minute:
1. Check browser console for errors (F12 > Console tab)
2. Close other browser tabs to free memory
3. Try a different browser (Chrome or Firefox recommended)
4. Reduce the session duration by exporting a shorter file from the Y-Trac app

**Q: Why are my lap times wrong?**

A: Lap detection relies on GPS-based finish line crossing. Inaccurate lap times can result from:
- Poor GPS accuracy (multipath, signal loss)
- Incorrect finish line configuration in the Y-Trac app
- Not completing full laps (e.g., cutting across the infield)

Verify the finish line coordinates in the Y-Trac app match the actual track start/finish.

### GPS and Map Issues

**Q: Why is the GPS track jittery or has sudden jumps?**

A: GPS accuracy varies based on satellite geometry, signal strength, and environmental factors. Common causes:
- Tall buildings or trees near the track
- Multipath (signal reflections)
- Poor satellite coverage (< 4 satellites)

These are hardware limitations of GPS receivers. Consider using external GPS with better antenna placement if accuracy is critical.

**Q: Can I use a different map provider (Google Maps, Mapbox, etc.)?**

A: The current version uses OpenStreetMap tiles. Support for alternative map providers is planned for a future release.

**Q: Why doesn't the map show satellite imagery?**

A: OpenStreetMap uses street map tiles, not satellite imagery. This may change in future versions.

### Telemetry Graphs

**Q: Why do some channels show zero or impossible values at the start of each lap?**

A: This is a known artifact of per-lap state reset in the native parser implementation. Channels like acceleration and pitch start at zero (which calibrates to physically impossible values like -7.0 G or -300 deg/s) until the first CAN message updates them.

This is expected behavior and does not affect the rest of the lap data.

**Q: Why is my lean angle always positive (never negative)?**

A: The web app displays "Lean Angle" (signed lean) by default, which preserves lean direction. If you're seeing only positive values, either:
- Your session genuinely had no left turns (e.g., oval track, drag strip)
- You're looking at the wrong channel (check the legend)

Both signed and unsigned lean channels are available in the CSV export.

**Q: Can I export the telemetry graphs as images?**

A: The current version does not support graph export. You can use browser screenshot tools (Ctrl+Shift+S in Firefox, Cmd+Shift+5 on macOS) to capture the graphs.

### Browser Compatibility

**Q: Why doesn't the app work in Internet Explorer?**

A: Internet Explorer is end-of-life and does not support modern web standards (Web Workers, ES2020, etc.). Please use a modern browser like Chrome, Firefox, Safari, or Edge.

**Q: The app works on my desktop but not on my phone. Why?**

A: Mobile browsers have stricter memory limits and may struggle with large files (>5 MB). Try:
- Using a desktop/laptop browser
- Reducing session duration
- Closing other browser tabs
- Using a newer phone with more RAM

**Q: I get a blank page when I load the app. What's wrong?**

A: This usually indicates a JavaScript error. Steps to diagnose:
1. Open browser console (F12 > Console)
2. Look for error messages (red text)
3. Report the error to the project maintainers with:
   - Browser name and version
   - Operating system
   - Screenshot of the console

### Performance and Optimization

**Q: The graphs are slow when zooming or panning. How can I improve performance?**

A: Try:
- Disable unused channel groups (Temperature, Fuel, Electronics, Acceleration)
- Close other browser tabs to free memory
- Use a desktop browser instead of mobile
- Upgrade to a faster computer (modern CPU recommended)

**Q: How long does it take to parse a typical session?**

A: Typical performance (30-minute session, ~2 MB file):
- Desktop (modern CPU): 50-100 ms
- Laptop: 100-200 ms
- Mobile: 200-500 ms

Very large files (>10 MB, 2+ hours) may take several seconds.

---

## Developer Guide

This section is for developers who want to build the web app from source or contribute to the project.

### Prerequisites

- Node.js 20 or later
- npm or pnpm package manager
- Git (for cloning the repository)

### Building from Source

#### 1. Clone the Repository

```bash
git clone https://github.com/your-org/ctrk-exporter.git
cd ctrk-exporter/web
```

#### 2. Install Dependencies

```bash
npm install
```

This will install:
- Astro (static site framework)
- Vue.js 3 (UI components)
- Chart.js (telemetry graphs)
- Leaflet.js (GPS map)
- TypeScript parser (shared with CLI)
- Vite (build tool)

#### 3. Run Development Server

```bash
npm run dev
```

The app will be available at `http://localhost:4321`. Changes to source files trigger automatic browser reload.

#### 4. Type Checking

```bash
npm run typecheck
```

This runs TypeScript compiler in check-only mode (no output). Fix any type errors before committing.

#### 5. Run Tests

```bash
npm test              # Run once
npm run test:watch    # Watch mode for development
```

### Production Build

```bash
npm run build
```

This creates a production-ready static site in `dist/`:
- Minified HTML, CSS, JavaScript
- Hashed filenames for cache busting
- Gzip/Brotli compression
- Source maps (for debugging)

**Build output size**: ~170 KB gzipped

### Preview Production Build

```bash
npm run preview
```

Serves the `dist/` directory at `http://localhost:4321` to test the production build locally.

### Project Structure

```
web/
├── src/
│   ├── components/           # Vue.js components
│   │   ├── AppHeader.vue     # Top navigation bar
│   │   ├── FileUpload.vue    # Drag-and-drop upload UI
│   │   ├── AnalyzePage.vue   # Main analysis page (map + graphs + timing)
│   │   └── Toast.vue         # Notification component
│   ├── composables/          # Vue composables (shared state)
│   │   └── useTelemetryData.ts  # Telemetry data store
│   ├── lib/                  # Utility libraries
│   │   ├── chart-config.ts   # Chart.js configuration
│   │   ├── file-validator.ts # CTRK file validation
│   │   └── lap-timing.ts     # Lap time computation
│   ├── layouts/
│   │   └── BaseLayout.astro  # Base HTML layout
│   ├── pages/                # Astro pages (routes)
│   │   ├── index.astro       # Landing page (/)
│   │   └── analyze.astro     # Analysis page (/analyze)
│   └── workers/
│       └── parser-worker.ts  # Web Worker for CTRK parsing
├── public/                   # Static assets (copied to dist/)
│   ├── favicon.svg
│   └── robots.txt
├── astro.config.mjs          # Astro configuration
├── package.json
├── tsconfig.json
└── vite.config.ts            # Vite build configuration
```

### Key Files

| File | Purpose |
|------|---------|
| `src/components/AnalyzePage.vue` | Main UI component orchestrating map, graphs, and timing table |
| `src/composables/useTelemetryData.ts` | Global state for telemetry data (reactive Vue store) |
| `src/lib/chart-config.ts` | Channel definitions, colors, and Chart.js configuration |
| `src/lib/file-validator.ts` | CTRK file validation (extension, size, magic bytes) |
| `src/lib/lap-timing.ts` | Lap time computation and formatting |
| `src/workers/parser-worker.ts` | Web Worker wrapper for the TypeScript parser |

### Configuration Files

| File | Purpose |
|------|---------|
| `astro.config.mjs` | Astro framework configuration (Vue integration, build settings) |
| `vite.config.ts` | Vite build tool configuration (dev server, optimizations) |
| `tsconfig.json` | TypeScript compiler configuration (strict mode, paths) |
| `package.json` | Node.js package manifest (dependencies, scripts) |

### Deployment

See the [Deployment](../web/README.md#deployment) section in the web README for detailed instructions on deploying to:
- Netlify
- Vercel
- GitHub Pages
- Cloudflare Pages
- AWS S3 + CloudFront
- Firebase Hosting

### Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/your-feature`)
3. Make your changes
4. Run tests and type checking (`npm test && npm run typecheck`)
5. Commit with descriptive message (`git commit -m "Add feature X"`)
6. Push to your fork (`git push origin feature/your-feature`)
7. Open a pull request

### Code Style

- **TypeScript**: Strict mode enabled
- **Formatting**: Prettier (run `npm run format`)
- **Linting**: ESLint (run `npm run lint`)
- **Naming**: camelCase for variables/functions, PascalCase for components/types

### Testing

Tests are written using Vitest:

```bash
npm test              # Run all tests once
npm run test:watch    # Watch mode (re-run on file changes)
npm run test:coverage # Generate coverage report
```

### Performance Profiling

To profile the parser:

1. Open Chrome DevTools (F12)
2. Go to Performance tab
3. Click Record
4. Upload a CTRK file
5. Stop recording
6. Analyze the flame graph for bottlenecks

### Debugging

#### Browser Console

Open browser console (F12) to see:
- Parser log messages
- Validation errors
- Chart rendering errors
- Network requests (map tiles)

#### Vue DevTools

Install [Vue DevTools](https://devtools.vuejs.org/) browser extension to:
- Inspect component state
- Track reactive data changes
- Profile component render times

#### Source Maps

Production builds include source maps for debugging minified code. In browser DevTools, you can view original TypeScript source even when running the production build.

---

## Related Documentation

- [CTRK Format Specification](/Users/timotheerebours/PersonalProjects/louis-file/docs/CTRK_FORMAT_SPECIFICATION.md) - Complete binary format spec
- [TypeScript Parser Documentation](/Users/timotheerebours/PersonalProjects/louis-file/docs/TYPESCRIPT_PARSER.md) - Parser API reference
- [Web README](/Users/timotheerebours/PersonalProjects/louis-file/web/README.md) - Developer-focused web app documentation
- [Project CLAUDE.md](/Users/timotheerebours/PersonalProjects/louis-file/CLAUDE.md) - Internal project structure and agent instructions

## Support

For bug reports, feature requests, or questions:

1. Check the [FAQ](#faq) section above
2. Search existing issues on the project repository
3. Open a new issue with:
   - Browser name and version
   - Operating system
   - CTRK file size and session duration
   - Steps to reproduce the problem
   - Screenshots or console error messages

## License

See the main project repository for license information.

---

**Document Version**: 1.0
**Last Updated**: 2026-02-07
**Target Application**: CTRK-Exporter Web Edition
**Compatible with**: Yamaha Y-Trac CCU (all versions)
